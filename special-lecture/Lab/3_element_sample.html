<!-- 
과제!
- 1단계: 코드 이해 (주석 작성: JS로 HTML element 조작 흐름 확인)
- 2단계: “동일 기능”을 다른 구조로 재작성
- 3단계: 기능 1개 “자유 확장” 
-->

<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>DOM CRUD Practice</title>
</head>
<body>
  <h2>DOM CRUD (Add / Delete / Edit)</h2>

  <!-- 할 일 입력 input -->
  <input id="txt" type="text" placeholder="할 일을 입력" />
  <!-- 추가 버튼 -->
  <button id="btnAdd">추가</button>

  <!-- 할 일 목록이 들어갈 ul -->
  <ul id="list"></ul>

  <script>
    // === DOM 요소(Element) 가져오기 ===
    const txt = document.getElementById("txt");        // 입력창 input 요소
    const btnAdd = document.getElementById("btnAdd");  // '추가' 버튼 요소
    const list = document.getElementById("list");      // 할 일 목록 ul 요소

    // === 리스트 아이템(li) 1개를 생성하는 함수 ===
    function createItem(text) {
      // li 요소 생성 (할 일 한 줄)
      const li = document.createElement("li");

      // span 요소 생성 (기본 표시용 텍스트)
      const span = document.createElement("span");
      span.textContent = text;

      // input 요소 생성 (수정 모드에서 보여줄 입력창)
      const input = document.createElement("input");
      input.type = "text";
      input.value = text;
      input.style.display = "none"; // 기본은 숨김 (수정 모드에서만 표시)

      // 수정 버튼 생성
      const btnEdit = document.createElement("button");
      btnEdit.textContent = "수정";

      // 저장 버튼 생성 (수정 모드에서만 표시)
      const btnSave = document.createElement("button");
      btnSave.textContent = "저장";
      btnSave.style.display = "none";

      // 취소 버튼 생성 (수정 모드에서만 표시)
      const btnCancel = document.createElement("button");
      btnCancel.textContent = "취소";
      btnCancel.style.display = "none";

      // 삭제 버튼 생성
      const btnDel = document.createElement("button");
      btnDel.textContent = "삭제";

      // 취소를 위해 "수정 전 값"을 저장하는 변수 (백업용)
      let prevText = text;

      // === 수정 모드 진입 함수 ===
      function enterEditMode() {
        // 현재 span 텍스트를 백업해둠 (취소 시 원래 값으로 돌아가기 위함)
        prevText = span.textContent;

        // input에 현재 값 넣고 수정 가능하게 준비
        input.value = prevText;

        // 표시 요소 전환: span 숨기고 input 보이기
        span.style.display = "none";
        input.style.display = "";

        // 버튼 표시 전환: 수정 -> 저장/취소
        btnEdit.style.display = "none";
        btnSave.style.display = "";
        btnCancel.style.display = "";

        // 수정 중에는 삭제 버튼 비활성화 (실수 방지)
        btnDel.disabled = true;

        // 커서를 input에 자동 이동
        input.focus();
        input.select(); // 텍스트 전체 선택
      }

      // === 수정 모드 종료 함수 ===
      function exitEditMode() {
        // 표시 요소 전환: span 보이고 input 숨김
        span.style.display = "";
        input.style.display = "none";

        // 버튼 표시 전환: 저장/취소 -> 수정
        btnEdit.style.display = "";
        btnSave.style.display = "none";
        btnCancel.style.display = "none";

        // 삭제 버튼 다시 활성화
        btnDel.disabled = false;
      }

      // === 이벤트 처리 ===

      // 수정 버튼 클릭 → 수정 모드 진입
      btnEdit.addEventListener("click", enterEditMode);

      // 저장 버튼 클릭 → input 값으로 span 업데이트 후 수정 모드 종료
      btnSave.addEventListener("click", () => {
        const value = input.value.trim();
        if (!value) return; // 빈 값이면 저장하지 않음

        span.textContent = value;
        exitEditMode();
      });

      // 취소 버튼 클릭 → 수정 전 값(prevText)으로 되돌리고 수정 모드 종료
      btnCancel.addEventListener("click", () => {
        // 원래 목적은 input을 되돌리는 것이지만,
        // 결과적으로 span도 원래 값이 유지되어야 하므로 복구 처리
        span.textContent = prevText;
        exitEditMode();
      });

      // 삭제 버튼 클릭 → 해당 li 요소 제거
      btnDel.addEventListener("click", () => li.remove());

      // 수정 input에서 키보드 처리
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") btnSave.click();     // Enter → 저장
        if (e.key === "Escape") btnCancel.click();  // ESC → 취소
      });

      // === li 내부에 요소를 순서대로 추가 ===
      li.appendChild(span);
      li.appendChild(input);
      li.appendChild(document.createTextNode(" ")); // 버튼 간 공백
      li.appendChild(btnEdit);
      li.appendChild(btnSave);
      li.appendChild(btnCancel);
      li.appendChild(btnDel);

      return li;
    }

    // === '추가' 버튼 이벤트 ===
    btnAdd.addEventListener("click", () => {
      // 입력값 읽기 + 양끝 공백 제거
      const value = txt.value.trim();
      if (!value) return; // 빈 문자열이면 추가 X

      // ul에 새 li 추가
      list.appendChild(createItem(value));

      // 입력창 초기화 후 커서 이동
      txt.value = "";
      txt.focus();
    });

    // 입력창에서 Enter 키 → 추가 버튼과 동일한 기능 실행
    txt.addEventListener("keydown", (e) => {
      if (e.key === "Enter") btnAdd.click();
    });
  </script>
</body>
</html>
